<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Gmscrobber by justan</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Gmscrobber</h1>
        <p>记录在线音乐到last.fm</p>

        <p class="view"><a href="https://github.com/justan/gmscrobber">View the Project on GitHub <small>justan/gmscrobber</small></a></p>


        <ul>
          <li><a href="https://github.com/justan/gmscrobber/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/justan/gmscrobber/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/justan/gmscrobber">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a href="http://justan.github.com/gmscrobber/">GMscrobber</a> - Scrobble Anywhere</h1>

<blockquote>
<p>某个时候听了某个音乐，因此自己心中的什么，发生了很大的变化…之类的</p>
</blockquote>

<p>gmscrobber 的目标是提供一种简单的方法来将在线播放的音乐记录到 <a href="http://last.fm">last.fm</a>.
安装 gmscrobber 需要 <a href="http://www.greasespot.net/">greasemonkey</a> 或者兼容环境(如 chrome + Tampermonkey 或 firefox + greasemonkey)</p>

<h2>GMscrobber 的特点</h2>

<ul>
<li>安全. 使用 last.fm 2.0 API 的 <a href="http://cn.last.fm/api/webauth">WEB Authentication </a>. 用户只在last.fm官方网站上输入用户名密码.</li>
<li>非侵入式. 和原来的页面融为一体, 就像它原来就在那里.</li>
<li>内置自动升级模块. 紧急升级的时候可以选择主动提示用户升级.</li>
<li>追求完美. 不想随便就记录一首歌曲? 对于开发者, GMscrobber 提供了精确的<a href="#%E6%AD%8C%E6%9B%B2%E6%8E%A7%E5%88%B6%E7%9B%B8%E5%85%B3">歌曲控制</a>方法, 想让在 80% 时记录, 就不会在 79% 时记录.</li>
<li>红星同步, 无视豆瓣电台广告...</li>
<li>程序内可停止使用:&gt;</li>
<li>歌词支持(待完成).</li>
</ul><h2>网站支持</h2>

<p>目前支持的网站有: <a href="http://douban.fm/">豆瓣电台</a>, <a href="http://g.top100.cn/16667639/html/player.html#loaded">谷歌音乐</a>, <a href="http://music.google.com">Google Music</a>, <a href="http://music.qq.com">QQ 音乐</a></p>

<h2>编写你自己的 scrobbler</h2>

<p>使用 GMscrobber 将使编写你自己的 scrobbler 变得非常简单, 如果已有 javascript 和 userscript 的编写经验, 写一个 scrobbler 只需要以下几步: </p>

<ol>
<li>
<p>在你喜欢的在线音乐播放页面新建一个用户脚本文件, 引入 simple_scrobbler_user: </p>

<div class="highlight">
<pre><span class="c1">// @require  https://raw.github.com/justan/gmscrobber/master/simple_scrobbler_user.js</span>
</pre>
</div>
</li>
<li>
<p>创建一个 Scrobber 实例: </p>

<p><code>var scrobber = new Scrobber({name: '在线音乐', ready: init})</code></p>
</li>
<li>
<p>创建你自己的播放器监控方法. 这是你代码的核心部分, <a href="#%E5%85%B3%E4%BA%8E%E9%A1%B5%E9%9D%A2%E6%92%AD%E6%94%BE%E5%99%A8%E7%9B%91%E6%8E%A7">后面</a>会详细讨论这一部分. 当歌曲开始播放的时候调用: </p>

<div class="highlight">
<pre><span class="nx">scrobber</span><span class="p">.</span><span class="nx">nowPlaying</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">'Wish You Were Here'</span><span class="p">,</span><span class="c1">//歌名</span>
  <span class="nx">artist</span><span class="o">:</span> <span class="s1">'Pink Floyd'</span><span class="p">,</span><span class="c1">//歌手</span>
  <span class="nx">duration</span><span class="o">:</span> <span class="mi">280</span><span class="p">,</span><span class="c1">//曲长</span>
  <span class="nx">album</span><span class="o">:</span> <span class="s1">'Wish You Were Here'</span><span class="c1">//专辑名</span>
<span class="p">});</span>
</pre>
</div>
</li>
<li><p>大功告成</p></li>
</ol><h3>关于页面播放器监控</h3>

<p>目前有两种办法监控页面的播放状态:</p>

<ol>
<li>最为普遍的, 我们并不清楚页面播放器的代码结构, 此种情况下可以编写一个页面歌曲信息获取函数, 将其传给  <code>scrobber.setSongInfoFN</code>, 剩下的 gmscrobber 会聪明的处理好. 示例: <a href="https://github.com/justan/gmscrobber/blob/master/qqmusicscrobber.user.js">QQ 音乐 scrobber</a>.</li>
<li>
<p>在页面播放器有可访问的播放状态变化函数的时候, 可以选择重新封装该函数. 如<a href="https://github.com/justan/gmscrobber/blob/master/dbscrobbler.user.js">豆瓣电台 scrobber</a>: </p>

<div class="highlight">
<pre><span class="kd">var</span> <span class="nx">ex</span> <span class="o">=</span> <span class="nx">unsafeWindow</span><span class="p">.</span><span class="nx">extStatusHandler</span><span class="p">;</span>
<span class="nx">unsafeWindow</span><span class="p">.</span><span class="nx">extStatusHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">songChangeInfo</span><span class="p">){</span>
  <span class="c1">//your code here</span>
  <span class="k">return</span> <span class="nx">ex</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span>
</pre>
</div>
</li>
</ol><h3>scrobber 编写示例</h3>

<ul>
<li><a href="http://blog.whosemind.net/blog/2012/06/15/zen-yang-ji-lu-qqyin-le-dao-last-dot-fm/">怎样记录 QQ 音乐到 last.fm</a></li>
</ul><h2>API</h2>

<p>在脚本中 require <em>simple_scrobbler_user</em> 后, 将得到两个有效接口:</p>

<ul>
<li><a href="#scrobbler">构造函数 Scrobbler</a></li>
<li><a href="#%E9%99%84%E5%8A%A0%E5%B7%A5%E5%85%B7">工具集 uso</a></li>
</ul><h3>Scrobbler</h3>

<p>主要的构造函数, 接收一个对象参数:</p>

<p><code>var scrobber = new Scrobber({name: '在线音乐', ready: init})</code></p>

<p><code>init</code>: 取得 sesionid 后的回调</p>

<p>提供两类实例方法.</p>

<ol>
<li>
<h4>last.fm 记录相关:</h4>

<ul>
<li>scrobber.nowPlaying</li>
<li>scrobber.scrobble</li>
<li>scrobber.love</li>
<li>scrobber.unlove</li>
<li>scrobber.getInfo</li>
<li>scrobber.ban</li>
<li>scrobber.unban</li>
</ul>
</li>
<li>
<h4>歌曲控制相关:</h4>

<ul>
<li>scrobber.play<br>
</li>
<li>scrobber.pause<br>
</li>
<li>scrobber.buffer </li>
<li>scrobber.stop </li>
<li>scrobber.seek</li>
</ul>
</li>
</ol><h3>附加工具</h3>

<p>在脚本中 require <em>simple_scrobbler_user</em> 后, 将会附送的几个可能有用的工具, 放置于 <code>uso</code> 对象中: </p>

<ul>
<li>
<code>uso.metaParse</code> userscript 的meta解析函数</li>
<li>
<code>uso.check</code> userscript.org 上脚本的自动升级工具</li>
<li>
<code>uso.watchContent</code> 页面文字变化监控工具</li>
</ul><h2>
<a href="https://userscripts.org/">userscripts.org</a> 上的GMscrobber</h2>

<ul>
<li><a href="https://userscripts.org/scripts/show/98833">豆瓣电台 scrobbler</a></li>
<li><a href="https://userscripts.org/scripts/show/92863">谷歌音乐(g.cn/music) scrobbler</a></li>
<li><a href="https://userscripts.org/scripts/show/111546">Google music scrobbler</a></li>
<li><a href="https://userscripts.org/scripts/show/136050">QQ 音乐</a></li>
</ul>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/justan">justan</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-12642431-2");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>